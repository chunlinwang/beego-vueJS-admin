(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-2590"],{"+Kng":function(t,e,r){"use strict";r.r(e);var n={name:"EditForm",components:{MenuDetail:r("PcBI").a}},o=r("KHd+"),s=Object(o.a)(n,function(){var t=this.$createElement;return(this._self._c||t)("menu-detail",{attrs:{"is-edit":!0}})},[],!1,null,null,null);s.options.__file="edit.vue";e.default=s.exports},HCLl:function(t,e,r){"use strict";var n=r("oweB");r.n(n).a},Hycs:function(t,e,r){"use strict";r.d(e,"b",function(){return o}),r.d(e,"c",function(){return s}),r.d(e,"a",function(){return a}),r.d(e,"d",function(){return i});var n=r("t3Un");function o(t){return Object(n.a)({url:"/menus/list",method:"get",params:t})}function s(t){return Object(n.a)({url:"/menus/"+t,method:"get"})}function a(t){return Object(n.a)({url:"/menus/",method:"post",data:t})}function i(t,e){return Object(n.a)({url:"/menus/update/"+t,method:"put",data:e})}},MSNs:function(t,e,r){"use strict";r.d(e,"a",function(){return o});var n=r("t3Un");function o(){return Object(n.a)({url:"/qiniu/upload/token",method:"get"})}},PcBI:function(t,e,r){"use strict";var n=r("m1cH"),o=r.n(n),s=r("P2sY"),a=r.n(s),i=r("LvDl"),l=r.n(i),c=r("glbJ"),u=r("fL+G"),p=r("Grqa"),d=r("uARZ"),m=r("Yfch"),f=r("xMja"),_=r("Hycs"),h={name:"",entries:[],plats:[],desserts:[],drinks:[],on_sale:!1,price:0,price_on_sale:0},b={name:"ProductDetail",components:{Tinymce:c.a,MDinput:p.a,Upload:u.a,Sticky:d.a},props:{isEdit:{type:Boolean,default:!1}},data:function(){var t=this,e=function(e,r,n){""===r?(t.$message({message:e.field+"为必传项",typlengthe:"error"}),n(new Error(e.field+"为必传项"))):n()};return{postForm:a()({},h),loading:!1,entries:[],plats:[],desserts:[],drinks:[],rules:{image_uri:[{validator:e}],title:[{validator:e}],content:[{validator:e}],source_uri:[{validator:function(e,r,n){r?Object(m.b)(r)?n():(t.$message({message:"外链url填写不正确",type:"error"}),n(new Error("外链url填写不正确"))):n()},trigger:"blur"}]},tempRoute:{}}},computed:{lang:function(){return this.$store.getters.language}},created:function(){if(this.isEdit){var t=this.$route.params&&this.$route.params.id;this.fetchData(t)}else this.postForm=a()({},h);this.tempRoute=a()({},this.$route)},methods:{addEntry:function(){this.postForm.entries=[].concat(o()(this.postForm.entries),[{code:"",extra_price:0}])},addPlat:function(){this.postForm.plats=[].concat(o()(this.postForm.plats),[{code:"",extra_price:0}])},addDessert:function(){this.postForm.desserts=[].concat(o()(this.postForm.desserts),[{code:"",extra_price:0}])},addDrink:function(){this.postForm.drinks=[].concat(o()(this.postForm.drinks),[{code:"",extra_price:0}])},deleteEntry:function(t){delete this.postForm.entries[t],this.postForm.entries=l.a.filter(this.postForm.entries,function(t){return void 0!==t})},deletePlat:function(t){delete this.postForm.plats[t],this.postForm.plats=l.a.filter(this.postForm.plats,function(t){return void 0!==t})},deleteDessert:function(t){delete this.postForm.desserts[t],this.postForm.desserts=l.a.filter(this.postForm.desserts,function(t){return void 0!==t})},deleteDrink:function(t){delete this.postForm.drinks[t],this.postForm.drinks=l.a.filter(this.postForm.drinks,function(t){return void 0!==t})},fetchData:function(t){var e=this;Object(_.c)(t).then(function(t){e.postForm=t.data}).catch(function(t){console.log(t)})},submitForm:function(){var t=this;this.$refs.postForm.validate(function(e){if(!e)return console.log("error submit!!"),!1;t.postForm.price=parseInt(t.postForm.price),t.postForm.price_on_sale=parseInt(t.postForm.price_on_sale),t.postForm.entries.map(function(t){return t.extra_price=parseInt(t.extra_price),t}),t.postForm.plats.map(function(t){return t.extra_price=parseInt(t.extra_price),t}),t.postForm.desserts.map(function(t){return t.extra_price=parseInt(t.extra_price),t}),t.postForm.drinks.map(function(t){return t.extra_price=parseInt(t.extra_price),t}),t.$route.params.id?Object(_.d)(t.$route.params.id,t.postForm).then(function(e){t.loading=!0;var r="成功",n="发布文章成功",o="success";0!==e.data.code&&(o="error",r="failed",n="save failed"),t.$notify({title:r,message:n,type:o,duration:2e3}),t.loading=!1},function(){t.$notify({title:"failed",message:"save failed",type:"error",duration:2e3})}):Object(_.a)(t.postForm).then(function(e){t.loading=!0;var r="成功",n="发布文章成功",o="success";0!==e.data.code&&(o="error",r="failed",n="save failed"),t.$notify({title:r,message:n,type:o,duration:2e3}),t.loading=!1,t.$router.push("/menu/list")},function(){t.$notify({title:"failed",message:"save failed",type:"error",duration:2e3})})})},draftForm:function(){0!==this.postForm.content.length&&0!==this.postForm.title.length?(this.$message({message:"保存成功",type:"success",showClose:!0,duration:1e3}),this.postForm.status="draft"):this.$message({message:"请填写必要的标题和内容",type:"warning"})},getRemoteEntryList:function(t){var e=this;Object(f.d)({category:"entry",query:t}).then(function(t){t.data.items&&(e.entries=t.data.items)})},getRemotePlatList:function(t){var e=this;Object(f.d)({category:"plat",query:t}).then(function(t){t.data.items&&(e.plats=t.data.items)})},getRemoteDessertList:function(t){var e=this;Object(f.d)({category:"dessert",query:t}).then(function(t){t.data.items&&(e.desserts=t.data.items)})},getRemoteDrinkList:function(t){var e=this;Object(f.d)({category:"drink",query:t}).then(function(t){t.data.items&&(e.drinks=t.data.items)})}}},v=(r("HCLl"),r("KHd+")),y=Object(v.a)(b,function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"createPost-container"},[r("el-form",{ref:"postForm",staticClass:"form-container",attrs:{model:t.postForm,rules:t.rules}},[r("sticky",{attrs:{"class-name":"sub-navbar "+t.postForm.status}},[r("el-button",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{"margin-left":"10px"},attrs:{type:"success"},on:{click:t.submitForm}},[t._v("发布\n      ")])],1),t._v(" "),r("div",{staticClass:"createPost-main-container"},[r("el-row",[r("el-col",{attrs:{span:24}},[r("el-row",[r("el-col",{attrs:{span:24}},[r("el-form-item",{attrs:{label:t.$t("menu.name"),"label-width":"80px"}},[r("el-input",{attrs:{type:"text",autosize:"",placeholder:"product name"},model:{value:t.postForm.name,callback:function(e){t.$set(t.postForm,"name",e)},expression:"postForm.name"}})],1)],1)],1),t._v(" "),r("div",{staticClass:"postInfo-container"},[r("el-row",[r("el-col",{attrs:{span:24}},[r("el-form-item",{attrs:{label:t.$t("menu.name"),"label-width":"80px"}},[r("el-input-number",{attrs:{type:"number",placeholder:"price"},model:{value:t.postForm.price,callback:function(e){t.$set(t.postForm,"price",e)},expression:"postForm.price"}},[r("template",{slot:"append"},[t._v(" euros ")])],2)],1)],1)],1),t._v(" "),r("el-row",[r("el-form-item",{staticStyle:{"margin-bottom":"10px"},attrs:{label:t.$t("menu.on_sale"),"label-width":"85px"}},[r("div",{staticClass:"box-item"},[r("el-switch",{model:{value:t.postForm.on_sale,callback:function(e){t.$set(t.postForm,"on_sale",e)},expression:"postForm.on_sale"}})],1)])],1),t._v(" "),r("el-row",[r("el-col",{attrs:{span:24}},[r("el-form-item",{attrs:{label:t.$t("menu.price_on_sale"),"label-width":"80px"}},[r("el-input-number",{attrs:{type:"number",placeholder:"on sale price"},model:{value:t.postForm.price_on_sale,callback:function(e){t.$set(t.postForm,"price_on_sale",e)},expression:"postForm.price_on_sale"}},[r("template",{slot:"append"},[t._v(" euros ")])],2)],1)],1)],1),t._v(" "),r("el-row",[r("el-form-item",{staticClass:"postInfo-container-item",attrs:{label:t.$t("menu.entry"),"label-width":"80px"}},[r("el-button",{attrs:{type:"primary",round:""},on:{click:function(e){t.addEntry()}}},[t._v(t._s(t.$t("menu.add_entry")))]),t._v(" "),t._l(t.postForm.entries,function(e,n){return r("el-row",{key:e._id},[r("span",[t._v(t._s(e.product.name))]),t._v(" "),r("el-col",{attrs:{span:24}},[r("el-form-item",{staticClass:"postInfo-container-item",attrs:{span:12,label:t.$t("menu.product_code"),"label-width":"80px"}},[r("el-select",{attrs:{"remote-method":t.getRemoteEntryList,placeholder:t.$t("search"),filterable:"",remote:""},model:{value:e.product,callback:function(r){t.$set(e,"product",r)},expression:"entry.product"}},t._l(t.entries,function(t){return r("el-option",{key:t._id,attrs:{label:t.name,value:t}})}))],1),t._v(" "),r("el-form-item",{staticClass:"postInfo-container-item",attrs:{label:t.$t("menu.supp_price"),span:12,"label-width":"80px"}},[r("el-input-number",{attrs:{placeholder:t.$t("menu.supp_price")},model:{value:e.extra_price,callback:function(r){t.$set(e,"extra_price",r)},expression:"entry.extra_price"}},[r("template",{slot:"append"},[t._v(" euros ")])],2)],1),t._v(" "),r("el-button",{attrs:{type:"danger",icon:"el-icon-delete",circle:""},on:{click:function(e){t.deleteEntry(n)}}})],1)],1)})],2)],1),t._v(" "),r("el-row",[r("el-form-item",{staticClass:"postInfo-container-item",attrs:{label:t.$t("menu.plat"),"label-width":"80px"}},[r("el-button",{attrs:{type:"primary",round:""},on:{click:function(e){t.addPlat()}}},[t._v(t._s(t.$t("menu.add_plat")))]),t._v(" "),t._l(t.postForm.plats,function(e,n){return r("el-row",{key:e._id},[r("span",[t._v(t._s(e.product.name))]),t._v(" "),r("el-col",{attrs:{span:24}},[r("el-form-item",{staticClass:"postInfo-container-item",attrs:{label:t.$t("menu.product_code"),"label-width":"80px"}},[r("el-select",{attrs:{"remote-method":t.getRemotePlatList,placeholder:t.$t("search"),autocomplete:"",filterable:"",remote:""},model:{value:e.product,callback:function(r){t.$set(e,"product",r)},expression:"plat.product"}},t._l(t.plats,function(t){return r("el-option",{key:t._id,attrs:{label:t.name,value:t}})}))],1),t._v(" "),r("el-form-item",{staticClass:"postInfo-container-item",attrs:{label:t.$t("menu.supp_price"),"label-width":"80px"}},[r("el-input-number",{attrs:{placeholder:t.$t("menu.supp_price")},model:{value:e.extra_price,callback:function(r){t.$set(e,"extra_price",r)},expression:"plat.extra_price"}},[r("template",{slot:"append"},[t._v(" euros ")])],2)],1),t._v(" "),r("el-button",{attrs:{type:"danger",icon:"el-icon-delete",circle:""},on:{click:function(e){t.deletePlat(n)}}})],1)],1)})],2)],1),t._v(" "),r("el-row",[r("el-form-item",{staticClass:"postInfo-container-item",attrs:{label:t.$t("menu.dessert"),"label-width":"80px"}},[r("el-button",{attrs:{type:"primary",round:""},on:{click:function(e){t.addDessert()}}},[t._v(t._s(t.$t("menu.add_dessert")))]),t._v(" "),t._l(t.postForm.desserts,function(e,n){return r("el-row",{key:e._id},[r("span",[t._v(t._s(e.product.name))]),t._v(" "),r("el-col",{attrs:{span:24}},[r("el-form-item",{staticClass:"postInfo-container-item",attrs:{label:"code:","label-width":"80px"}},[r("el-select",{attrs:{"remote-method":t.getRemoteDessertList,placeholder:t.$t("search"),filterable:"",remote:""},model:{value:e.product,callback:function(r){t.$set(e,"product",r)},expression:"dessert.product"}},t._l(t.desserts,function(t){return r("el-option",{key:t._id,attrs:{label:t.name,value:t}})}))],1),t._v(" "),r("el-form-item",{staticClass:"postInfo-container-item",attrs:{label:t.$t("menu.supp_price"),"label-width":"80px"}},[r("el-input-number",{attrs:{placeholder:t.$t("menu.supp_price")},model:{value:e.extra_price,callback:function(r){t.$set(e,"extra_price",r)},expression:"dessert.extra_price"}},[r("template",{slot:"append"},[t._v(" euros ")])],2),t._v(" "),r("el-button",{attrs:{type:"danger",icon:"el-icon-delete",circle:""},on:{click:function(e){t.deleteDessert(n)}}})],1)],1)],1)})],2)],1),t._v(" "),r("el-row",[r("el-form-item",{staticClass:"postInfo-container-item",attrs:{label:t.$t("menu.drink"),"label-width":"80px"}},[r("el-button",{attrs:{type:"primary",round:""},on:{click:function(e){t.addDrink()}}},[t._v(t._s(t.$t("menu.drink")))]),t._v(" "),t._l(t.postForm.drinks,function(e,n){return r("el-row",{key:e._id},[r("el-col",{attrs:{span:24}},[r("span",[t._v(t._s(e.product.name))]),t._v(" "),r("el-form-item",{staticClass:"postInfo-container-item",attrs:{label:"code:","label-width":"80px"}},[r("el-select",{attrs:{"remote-method":t.getRemoteDrinkList,placeholder:t.$t("search"),filterable:"",remote:""},model:{value:e.product,callback:function(r){t.$set(e,"product",r)},expression:"drink.product"}},t._l(t.drinks,function(t){return r("el-option",{key:t._id,attrs:{label:t.name,value:t}})}))],1),t._v(" "),r("el-form-item",{staticClass:"postInfo-container-item",attrs:{label:t.$t("menu.supp_price"),"label-width":"80px"}},[r("el-input-number",{attrs:{placeholder:t.$t("menu.supp_price")},model:{value:e.extra_price,callback:function(r){t.$set(e,"extra_price",r)},expression:"drink.extra_price"}},[r("template",{slot:"append"},[t._v(" euros ")])],2),t._v(" "),r("el-button",{attrs:{type:"danger",icon:"el-icon-delete",circle:""},on:{click:function(e){t.deleteDrink(n)}}})],1)],1)],1)})],2)],1)],1)],1)],1)],1)],1)],1)},[],!1,null,"056d407d",null);y.options.__file="MenuDetail.vue";e.a=y.exports},Yfch:function(t,e,r){"use strict";function n(t){return["admin"].indexOf(t.trim())>=0}function o(t){return/^(https?|ftp):\/\/([a-zA-Z0-9.-]+(:[a-zA-Z0-9.&%$-]+)*@)*((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]?)(\.(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])){3}|([a-zA-Z0-9-]+\.)*[a-zA-Z0-9-]+\.(com|edu|gov|int|mil|net|org|biz|arpa|info|name|pro|aero|coop|museum|[a-zA-Z]{2}))(:[0-9]+)*(\/($|[a-zA-Z0-9.,?'\\+&%$#=~_-]+))*$/.test(t)}r.d(e,"a",function(){return n}),r.d(e,"b",function(){return o})},oweB:function(t,e,r){},xMja:function(t,e,r){"use strict";r.d(e,"b",function(){return o}),r.d(e,"c",function(){return s}),r.d(e,"a",function(){return a}),r.d(e,"e",function(){return i}),r.d(e,"d",function(){return l});var n=r("t3Un");function o(t){return Object(n.a)({url:"/products/list",method:"get",params:t})}function s(t){return Object(n.a)({url:"/products/"+t,method:"get"})}function a(t){return Object(n.a)({url:"/products/",method:"post",data:t})}function i(t,e){return Object(n.a)({url:"/products/update/"+t,method:"put",data:e})}function l(t){return Object(n.a)({url:"/products",method:"get",params:t})}}}]);
//# sourceMappingURL=chunk-2590.4b33c21f.js.map